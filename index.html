<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ù†ÙŠØ© | Ù†ÙˆÙ Ø®Ø¨ØªÙŠ</title>

<style>
:root{
  --bg1:#fff3fb; --bg2:#f1fff6; --bg3:#f3f6ff;
  --card: rgba(255,255,255,.82);
  --border: rgba(17,24,39,.10);
  --text:#111827; --muted:#6b7280;
  --shadow: 0 18px 40px rgba(0,0,0,.10);
  --radius: 22px;
  --p1:#ff5ea8; --p2:#7c5cff; --p3:#22c55e; --p4:#06b6d4; --p5:#f59e0b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 10% 10%, var(--bg1), transparent 60%),
    radial-gradient(1000px 600px at 90% 20%, var(--bg2), transparent 55%),
    radial-gradient(900px 600px at 50% 95%, var(--bg3), transparent 55%);
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:26px 18px;
}
.wrap{ width:min(1120px,100%); display:flex; flex-direction:column; gap:18px; }

/* header */
.topHeader{
  text-align:center;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:22px 18px;
}
.topHeader h1{ margin:0; font-size:30px; font-weight:1000; }
.topHeader p{ margin-top:8px; font-size:14px; color:rgba(17,24,39,.75); line-height:1.8; font-weight:700; }
.topHeader hr{ border:0; border-top:1px solid rgba(17,24,39,.08); margin:16px auto 0; width:min(680px,92%); }

.grid{ display:grid; grid-template-columns:1fr 1fr; gap:18px; }
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  min-height:520px;
}

/* identity */
.identityWrap{ padding:18px; display:flex; flex-direction:column; gap:14px; height:100%; }
.identityWrap h2{ text-align:center; font-size:24px; font-weight:1000; margin:0; }
.vision{
  background:rgba(255,255,255,.7);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
  font-size:14.5px;
  line-height:2;
  text-align:center;
}

/* icons 2x2 */
.icons{ margin-top:auto; display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.iconBtn{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:14px; border-radius:18px; border:1px solid var(--border);
  background:rgba(255,255,255,.9);
  text-decoration:none; color:var(--text);
  min-height:76px;
  transition:transform .15s ease, box-shadow .15s ease;
}
.iconBtn:hover{ transform:translateY(-2px); box-shadow:0 12px 24px rgba(0,0,0,.12); }
.iconTxt{ display:flex; flex-direction:column; gap:4px; min-width:0; }
.iconTxt .t{ font-weight:1000; font-size:14px; line-height:1.2; }
.iconTxt .d{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:230px; }
.iconBubble{
  width:44px; height:44px; border-radius:16px;
  display:grid; place-items:center; color:#fff; font-size:20px; flex:0 0 auto;
  box-shadow:0 10px 18px rgba(0,0,0,.12);
}
.g1{background:linear-gradient(135deg,var(--p1),var(--p5))}
.g2{background:linear-gradient(135deg,var(--p2),var(--p1))}
.g3{background:linear-gradient(135deg,var(--p4),#3b82f6)}
.g4{background:linear-gradient(135deg,var(--p3),var(--p4))}

/* slider */
.mediaWrap{ padding:16px; display:flex; flex-direction:column; gap:12px; height:100%; }
.stage{
  position:relative; flex:1;
  border-radius:18px; border:1px solid var(--border);
  background:#fff; overflow:hidden;
}

/* caption */
.caption{
  position:absolute; top:12px; right:12px; left:12px;
  z-index:6; display:flex; justify-content:space-between; gap:10px;
  pointer-events:none;
}
.capPill{
  max-width:70%;
  background:rgba(255,255,255,.88);
  border:1px solid rgba(0,0,0,.10);
  padding:8px 12px; border-radius:999px;
  font-size:12px; font-weight:950;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;

  opacity:0; transform:translateY(-8px);
  transition:.35s ease;
}
.capPill.show{ opacity:1; transform:translateY(0); }
.counter{
  background:rgba(255,255,255,.88);
  border:1px solid rgba(0,0,0,.10);
  padding:8px 10px; border-radius:999px;
  font-size:12px; color:var(--muted);
  white-space:nowrap;
}

/* skeleton */
.skeleton{ position:absolute; inset:0; padding:12px; z-index:5; display:none; }
.stage.loading .skeleton{ display:block; }
.skeletonBox{
  width:100%; height:100%;
  border-radius:14px;
  border:1px solid rgba(17,24,39,.08);
  background:linear-gradient(90deg,
    rgba(240,240,245,.75) 0%,
    rgba(255,255,255,.95) 45%,
    rgba(240,240,245,.75) 100%);
  background-size:200% 100%;
  animation:shimmer 1.2s infinite linear;
}
@keyframes shimmer{ 0%{background-position:200% 0} 100%{background-position:-200% 0} }

.viewer{ position:absolute; inset:0; padding:12px; display:grid; place-items:center; }
.viewer iframe{ width:100%; height:100%; border:0; border-radius:14px; background:#fff !important; }
.viewer img,.viewer video{ width:100%; height:100%; object-fit:cover; border-radius:14px; background:#fff; }

.dots{ display:flex; justify-content:center; gap:8px; flex-wrap:wrap; }
.dot{ width:10px; height:10px; border-radius:50%; border:1px solid rgba(0,0,0,.2); cursor:pointer; background:rgba(255,255,255,.9); }
.dot.active{ width:26px; border-radius:999px; background:linear-gradient(135deg,var(--p1),var(--p2)); }

.controls{ display:flex; gap:10px; }
.controls button{
  flex:1; padding:10px; border-radius:999px; border:1px solid var(--border);
  background:#fff; font-weight:900; cursor:pointer;
}

.status{
  text-align:center;
  color:var(--muted);
  font-weight:900;
  font-size:12px;
  margin-top:-4px;
}

.foot{ text-align:center; font-size:12px; color:var(--muted); padding:12px; border-top:1px solid var(--border); }

@media(max-width:900px){ .grid{grid-template-columns:1fr} }
</style>
</head>

<body>
<div class="wrap">

<header class="topHeader">
  <h1>Ù†ÙˆÙ Ø®Ø¨ØªÙŠ</h1>
  <p>Ù…Ø¹Ù„Ù…Ø© ÙÙŠØ²ÙŠØ§Ø¡ ÙˆÙ…Ø¨Ø§Ø¯ÙØ±Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©ØŒ Ø£Ø¤Ù…Ù† Ø¨Ø£Ù† Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚ ÙŠØµÙ†Ø¹ Ø£Ø«Ø±Ù‹Ø§ Ù…Ø³ØªØ¯Ø§Ù…Ù‹Ø§.</p>
  <hr>
</header>

<main class="grid">

  <!-- ÙŠÙ…ÙŠÙ†: Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ù†ÙŠØ© -->
  <section class="card">
    <div class="identityWrap">
      <h2>Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</h2>
      <div class="vision">
        ØªØªØ´ÙƒÙ„ Ø±Ø¤ÙŠØªÙŠ Ù…Ù† ÙÙ„Ø³ÙØ© ØªØ±Ø¨ÙˆÙŠØ© ØªÙØ¹Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙÙ‡Ù… ÙˆØ§Ù„Ù…Ø¹Ù†Ù‰ØŒ ÙˆØªØ¯Ø¹Ù…Ù‡Ø§ Ù…Ù…Ø§Ø±Ø³Ø§Øª ØªØ¯Ø±ÙŠØ³ÙŠØ© ØªÙØ­Ø³Ù† Ø§Ù„ØªØ¹Ù„Ù…
        ÙˆØªÙÙØ¹Ù„ Ø§Ù„Ø­ÙˆØ§Ø± ÙˆØ§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯ØŒ ÙˆØªØ³ØªØ«Ù…Ø± Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ¬ÙˆÙŠØ¯ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª.
      </div>
      <div class="icons" id="icons"></div>
    </div>
    <div class="foot">Â© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” Ù†ÙˆÙ Ø®Ø¨ØªÙŠ</div>
  </section>

  <!-- ÙŠØ³Ø§Ø±: Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± -->
  <section class="card">
    <div class="mediaWrap">
      <div class="stage" id="stage">
        <div class="caption">
          <div class="capPill" id="capText">â€”</div>
          <div class="counter" id="countText">0/0</div>
        </div>

        <div class="skeleton"><div class="skeletonBox"></div></div>
        <div class="viewer" id="viewer"></div>
      </div>

      <div class="dots" id="dots"></div>

      <div class="controls">
        <button id="prevBtn">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button id="toggleBtn">Ø¥ÙŠÙ‚Ø§Ù</button>
        <button id="nextBtn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>

      <div class="status" id="status">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øªâ€¦</div>
    </div>
    <div class="foot">Â© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” Ù†ÙˆÙ Ø®Ø¨ØªÙŠ</div>
  </section>

</main>
</div>

<script>
/* âœ… Ø´ÙŠØª Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª (title,url,icon,desc) */
const LINKS_CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQaN3UjaCfxytCPsU6tVG3q4Doq5MzAga4eN9DNn7CXHO2AgikUq0F3PggFNgMub2C2if6LoRuRDRoD/pub?output=csv";

/* âœ… Ø´ÙŠØª Ø§Ù„ÙˆØ³Ø§Ø¦Ø· â€” ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙŠÙ‡ */
const MEDIA_CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTEHayG4LZPyitS9dWgRweARkU4gWhGc0vxUFjZbOan32ZG6B9zSYpAKd02bE2nkysvXoIC3EH-iN4O/pub?output=csv";

const INTERVAL_MS = 7000;

/* CSV robust */
function splitCSVLine(line){
  const res=[]; let cur="", inQ=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i];
    if(ch === '"'){
      if(inQ && line[i+1] === '"'){ cur+='"'; i++; }
      else inQ=!inQ;
    } else if(ch === ',' && !inQ){
      res.push(cur); cur="";
    } else cur+=ch;
  }
  res.push(cur);
  return res.map(s=>s.trim());
}
function parseCSV(text){
  const clean = (text||"").replace(/^\uFEFF/, ""); // BOM
  const lines = clean.trim().split(/\r?\n/).filter(l=>l.trim()!=="");
  if(lines.length < 2) return [];
  // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù‚Ø±Ø£ Ø§Ù„ØµÙÙˆÙ ÙÙ‚Ø·: A=type, B=url, C=title
  return lines.slice(1).map(splitCSVLine);
}

/* Drive preview helper */
function toDrivePreview(url){
  const m = String(url||"").match(/drive\.google\.com\/file\/d\/([^/]+)/i);
  if(!m) return url;
  return `https://drive.google.com/file/d/${m[1]}/preview`;
}

function esc(s){
  return String(s||"")
    .replaceAll("&","&amp;").replaceAll("<","&lt;")
    .replaceAll(">","&gt;").replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* icons from links sheet (expects: title,url,icon,desc) */
async function loadIcons(){
  const iconsEl = document.getElementById("icons");
  try{
    const r = await fetch(LINKS_CSV_URL, {cache:"no-store"});
    const t = await r.text();
    const rows = parseCSV(t);

    const items = rows.map(row=>({
      title:(row[0]||"").trim(),
      url:(row[1]||"").trim(),
      icon:(row[2]||"ğŸ”—").trim(),
      desc:(row[3]||"").trim(),
    })).filter(x=>x.title && x.url).slice(0,4);

    iconsEl.innerHTML="";
    const bubbles=["g1","g2","g3","g4"];
    items.forEach((it, idx)=>{
      const a=document.createElement("a");
      a.className="iconBtn";
      a.href=it.url; a.target="_blank"; a.rel="noopener";
      a.innerHTML=`
        <div class="iconTxt">
          <div class="t">${esc(it.title)}</div>
          <div class="d">${esc(it.desc||"")}</div>
        </div>
        <div class="iconBubble ${bubbles[idx%4]}">${esc(it.icon)}</div>
      `;
      iconsEl.appendChild(a);
    });

    if(!items.length){
      iconsEl.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:#6b7280;font-weight:900;">Ø´ÙŠØª Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙØ§Ø±Øº</div>`;
    }
  }catch(e){
    iconsEl.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:#ef4444;font-weight:900;">ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø´ÙŠØª Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</div>`;
  }
}

/* slider */
let MEDIA=[]; let idx=0; let playing=true; let timer=null;

const stage=document.getElementById("stage");
const viewer=document.getElementById("viewer");
const dots=document.getElementById("dots");
const cap=document.getElementById("capText");
const count=document.getElementById("countText");
const status=document.getElementById("status");
const prevBtn=document.getElementById("prevBtn");
const nextBtn=document.getElementById("nextBtn");
const toggleBtn=document.getElementById("toggleBtn");

function showSkeleton(on){ stage.classList.toggle("loading", !!on); }

function setCaption(text){
  cap.classList.remove("show");
  cap.textContent = (text && text.trim()) ? text.trim() : "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
  requestAnimationFrame(()=> cap.classList.add("show"));
}

function buildDots(){
  dots.innerHTML="";
  MEDIA.forEach((_,i)=>{
    const dot=document.createElement("div");
    dot.className="dot";
    dot.onclick=()=>go(i,true);
    dots.appendChild(dot);
  });
}

function renderCurrent(){
  if(!MEDIA.length) return;

  [...dots.children].forEach((d,i)=>d.classList.toggle("active", i===idx));

  const item = MEDIA[idx];
  setCaption(item.title);
  count.textContent = `${idx+1}/${MEDIA.length}`;

  showSkeleton(true);
  viewer.innerHTML="";

  // Drive preview Ø§Ù„Ø£ÙØ¶Ù„ iframe
  const type = (item.type || "iframe").toLowerCase();

  if(type === "image"){
    const img=document.createElement("img");
    img.src=item.url;
    img.alt=item.title || "image";
    img.onload=()=>showSkeleton(false);
    img.onerror=()=>{ // fallback
      const f=document.createElement("iframe");
      f.src=item.url;
      f.onload=()=>showSkeleton(false);
      viewer.innerHTML="";
      viewer.appendChild(f);
    };
    viewer.appendChild(img);
  } else {
    const f=document.createElement("iframe");
    f.src=item.url;
    f.onload=()=>showSkeleton(false);
    f.onerror=()=>showSkeleton(false);
    viewer.appendChild(f);
  }
}

function go(i, manual=false){
  idx = (i + MEDIA.length) % MEDIA.length;
  renderCurrent();
  if(manual) restart();
}
function next(manual=false){ go(idx+1, manual); }
function prev(manual=false){ go(idx-1, manual); }

function toggle(){
  playing = !playing;
  toggleBtn.textContent = playing ? "Ø¥ÙŠÙ‚Ø§Ù" : "ØªØ´ØºÙŠÙ„";
}
function restart(){
  if(timer) clearInterval(timer);
  timer = setInterval(()=>{ if(playing) next(false); }, INTERVAL_MS);
}

async function loadMedia(){
  status.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø´ÙŠØªâ€¦";
  try{
    const r = await fetch(MEDIA_CSV_URL, {cache:"no-store"});
    const t = await r.text();
    const rows = parseCSV(t);

    MEDIA = rows.map(row=>{
      let type  = (row[0]||"iframe").trim().toLowerCase();
      let url   = (row[1]||"").trim();
      let title = (row[2]||"").trim();

      if(!url) return null;

      // Drive -> preview + iframe
      if(/drive\.google\.com\/file\/d\//i.test(url)){
        url = toDrivePreview(url);
        type = "iframe";
      }

      if(!["iframe","image","video"].includes(type)) type = "iframe";
      return {type, url, title};
    }).filter(Boolean);

    status.textContent = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${MEDIA.length} Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø´ÙŠØª`;

    buildDots();

    if(MEDIA.length){
      idx = 0;
      go(0,false);
      restart();
    } else {
      viewer.innerHTML = `<div style="text-align:center;color:#6b7280;font-weight:900;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ø´ÙŠØª</div>`;
      setCaption("");
      count.textContent = "0/0";
      showSkeleton(false);
    }
  }catch(e){
    viewer.innerHTML = `<div style="text-align:center;color:#ef4444;font-weight:900;">ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø´ÙŠØª Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</div>`;
    setCaption("ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„");
    count.textContent = "0/0";
    showSkeleton(false);
    status.textContent = "ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ â€” ØªØ£ÙƒØ¯ÙŠ Ø£Ù† Ø±Ø§Ø¨Ø· CSV ÙŠØ¹Ù…Ù„";
  }
}

prevBtn.onclick=()=>prev(true);
nextBtn.onclick=()=>next(true);
toggleBtn.onclick=toggle;

loadIcons();
loadMedia();

// ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
setInterval(loadMedia, 60000);
setInterval(loadIcons, 60000);
</script>
</body>
</html>
